<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolfclaw AI Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/styles.css?v=2">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Drawflow for Visual Flow Builder -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jerosoler/Drawflow/dist/drawflow.min.css">
    <script src="https://cdn.jsdelivr.net/gh/jerosoler/Drawflow/dist/drawflow.min.js"></script>
</head>

<body class="theme-dark">
    <!-- Authentication Overlay (Visible when not logged in) -->
    <div id="auth-container" class="auth-fullscreen hidden">
        <div class="auth-card">
            <div class="auth-header">
                <img src="/static/img/wolfclaw-logo.png?v=2" alt="Wolfclaw"
                    style="width:80px; height:80px; border-radius:16px; margin-bottom:1rem; box-shadow: 0 0 30px rgba(88,166,255,0.3);">
                <h2 style="font-weight:800; letter-spacing:-0.03em;">Wolfclaw</h2>
                <p style="color: var(--text-muted); font-size:0.9rem;">AI Command Center</p>
                <span
                    style="display:inline-block; margin-top:0.5rem; padding:2px 10px; border-radius:20px; font-size:0.7rem; font-weight:600; background:rgba(88,166,255,0.15); color:var(--primary-color); border:1px solid rgba(88,166,255,0.3);">v2.0</span>
            </div>

            <div id="login-view">
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <div class="password-input-group">
                            <input type="password" id="login-password" required>
                            <i class="fa-solid fa-eye-slash toggle-pw"
                                onclick="togglePasswordVisibility('login-password', this)"></i>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Sign in</button>
                    <div class="auth-links">
                        <a href="#" onclick="switchAuthView('register')">Create an account</a> |
                        <a href="#" onclick="switchAuthView('forgot')">Forgot Password?</a>
                    </div>
                </form>
            </div>

            <div id="register-view" class="hidden">
                <form id="register-form">
                    <div class="form-group">
                        <label for="reg-email">Email</label>
                        <input type="email" id="reg-email" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Password</label>
                        <div class="password-input-group">
                            <input type="password" id="reg-password" required>
                            <i class="fa-solid fa-eye-slash toggle-pw"
                                onclick="togglePasswordVisibility('reg-password', this)"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm">Confirm Password</label>
                        <div class="password-input-group">
                            <input type="password" id="reg-confirm" required>
                            <i class="fa-solid fa-eye-slash toggle-pw"
                                onclick="togglePasswordVisibility('reg-confirm', this)"></i>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Register</button>
                    <div class="auth-links">
                        <a href="#" onclick="switchAuthView('login')">Back to Sign in</a>
                    </div>
                </form>
            </div>

            <div id="forgot-view" class="hidden">
                <form id="forgot-form">
                    <p class="help-text"
                        style="color: var(--danger-color); font-weight: 500; font-size: 0.85em; margin-bottom: 15px;">
                        This is an offline app. To reset your password, you must enter the Master Recovery Key shown to
                        you during registration.
                    </p>
                    <div class="form-group">
                        <label for="forgot-email">Email</label>
                        <input type="email" id="forgot-email" required>
                    </div>
                    <div class="form-group">
                        <label for="forgot-key">Master Recovery Key</label>
                        <input type="text" id="forgot-key" required placeholder="e.g. abc123def456">
                    </div>
                    <div class="form-group">
                        <label for="forgot-new-password">New Password</label>
                        <div class="password-input-group">
                            <input type="password" id="forgot-new-password" required>
                            <i class="fa-solid fa-eye-slash toggle-pw"
                                onclick="togglePasswordVisibility('forgot-new-password', this)"></i>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning btn-block">Reset Password</button>
                    <div class="auth-links">
                        <a href="#" onclick="switchAuthView('login')">Back to Sign in</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Application Layout (Visible when logged in) -->
    <div id="app-container" class="app-layout">

        <!-- Top Navigation Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <img src="/static/img/wolfclaw-logo.png?v=2" alt="" style="width:28px; height:28px; border-radius:6px;">
                <span class="topbar-title">Wolfclaw AI</span>
            </div>
            <div class="topbar-right">
                <label class="eli5-toggle" title="Simple Mode ‚Äî makes all AI responses easy to understand">
                    <input type="checkbox" id="eli5-toggle" onchange="toggleELI5(this.checked)">
                    <span>üßí Simple</span>
                </label>
                <button id="theme-toggle" class="icon-btn" title="Toggle Light/Dark Mode">
                    <i class="fa-solid fa-moon"></i>
                </button>
                <div class="user-profile">
                    <i class="fa-solid fa-user-circle"></i>
                    <span id="current-user-email">user@localhost</span>
                </div>
                <button id="logout-btn" class="btn btn-sm btn-danger">Log out</button>
            </div>
        </header>

        <div class="main-body">
            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <div class="sidebar-menu">
                    <a href="#" class="nav-item active" data-view="dashboard">
                        <i class="fa-solid fa-gauge"></i> Dashboard
                    </a>
                    <a href="#" class="nav-item" data-view="manage-bots">
                        <i class="fa-solid fa-robot"></i> Manage Bots
                    </a>
                    <a href="#" class="nav-item" data-view="bot-profiles">
                        <i class="fa-solid fa-id-card"></i> Bot Profiles
                    </a>
                    <a href="#" class="nav-item" data-view="chat">
                        <i class="fa-solid fa-comments"></i> Chat
                    </a>
                    <a href="#" class="nav-item" data-view="ai-roles">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> AI Roles
                    </a>
                    <a href="#" class="nav-item" data-view="saved">
                        <i class="fa-solid fa-star"></i> Saved
                    </a>

                    <div class="sidebar-section-title">Logs</div>
                    <a href="#" class="nav-item" data-view="activity-log">
                        <i class="fa-solid fa-list-check"></i> Activity Log
                    </a>
                    <a href="#" class="nav-item" data-view="analytics">
                        <i class="fa-solid fa-chart-line"></i> Analytics
                    </a>

                    <div class="sidebar-section-title">System</div>
                    <a href="#" class="nav-item" data-view="knowledge-base">
                        <i class="fa-solid fa-brain"></i> Knowledge Base
                    </a>
                    <a href="#" class="nav-item" data-view="automations">
                        <i class="fa-solid fa-clock-rotate-left"></i> Automations
                    </a>
                    <a href="#" class="nav-item" data-view="flows">
                        <i class="fa-solid fa-diagram-project"></i> Flows
                    </a>
                    <a href="#" class="nav-item" data-view="remote-servers">
                        <i class="fa-solid fa-server"></i> Remote Servers
                    </a>
                    <a href="#" class="nav-item" data-view="channels">
                        <i class="fa-brands fa-telegram"></i> Deploy Channels
                    </a>
                    <a href="#" class="nav-item" data-view="settings">
                        <i class="fa-solid fa-gear"></i> Settings
                    </a>
                </div>
            </aside>

            <!-- Dynamic Content Area -->
            <main class="content-area">
                <!-- Dashboard View -->
                <div id="view-dashboard" class="view-panel active">
                    <h1>Dashboard</h1>
                    <p>Welcome to your AI Command Center.</p>
                    <div class="card-grid">
                        <div class="card">
                            <h3><i class="fa-solid fa-robot"></i> Active Bots</h3>
                            <div class="metric-value" id="dash-bot-count">0</div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-solid fa-server"></i> SSH Server</h3>
                            <div id="dash-server-status" style="font-size:1.1rem; font-weight:600;">Not Configured</div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-solid fa-key"></i> API Keys</h3>
                            <div class="metric-value" id="dash-keys-count">0 / 5</div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-brands fa-telegram"></i> Live Workers</h3>
                            <div id="dash-worker-count" style="font-size:1.1rem; font-weight:600;"><span
                                    class="live-dot"></span> 0</div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-solid fa-wrench"></i> Tools Available</h3>
                            <div class="metric-value">7</div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-solid fa-clock"></i> Uptime</h3>
                            <div id="dash-uptime"
                                style="font-size:1.1rem; font-weight:600; color: var(--success-color);">0m</div>
                        </div>
                    </div>
                </div>

                <!-- Knowledge Base View -->
                <div id="view-knowledge-base" class="view-panel hidden">
                    <h1><i class="fa-solid fa-brain"></i> Knowledge Base</h1>
                    <p>Upload documents to give your bots permanent, searchable knowledge. Any PDF, DOCX, TXT, CSV, or
                        MD file works.</p>

                    <div class="card" style="margin-top:15px;">
                        <h3>Select Bot</h3>
                        <select id="kb-bot-select" class="form-control" style="max-width:350px;"
                            onchange="loadBotKnowledge()">
                            <option value="">-- Select a Bot --</option>
                        </select>
                    </div>

                    <div id="kb-content" class="hidden" style="margin-top:15px;">
                        <div class="card">
                            <h3><i class="fa-solid fa-file-arrow-up"></i> Upload Document</h3>
                            <div style="display:flex; gap:10px; align-items:center; margin-top:10px;">
                                <input type="file" id="kb-file-input" accept=".pdf,.docx,.txt,.csv,.md" style="flex:1;">
                                <button class="btn btn-primary" onclick="uploadKnowledgeDoc()"><i
                                        class="fa-solid fa-upload"></i> Upload & Index</button>
                            </div>
                            <p id="kb-upload-status" style="margin-top:8px; font-size:0.85em; color:var(--text-muted);">
                            </p>
                        </div>

                        <div class="card" style="margin-top:15px;">
                            <h3><i class="fa-solid fa-folder-open"></i> Indexed Documents</h3>
                            <div id="kb-doc-list" style="margin-top:10px;">
                                <p style="color:var(--text-muted);">No documents uploaded yet.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Automations View -->
                <div id="view-automations" class="view-panel hidden">
                    <h1><i class="fa-solid fa-clock-rotate-left"></i> Automations</h1>
                    <p>Schedule recurring AI tasks. Your bots will automatically execute prompts on a timer.</p>

                    <div class="card" style="margin-top:15px;">
                        <h3><i class="fa-solid fa-plus"></i> Create New Task</h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                            <div>
                                <label>Task Name</label>
                                <input type="text" id="sched-name" class="form-control"
                                    placeholder="Daily Market Report">
                            </div>
                            <div>
                                <label>Bot</label>
                                <select id="sched-bot-select" class="form-control">
                                    <option value="">-- Select Bot --</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top:10px;">
                            <label>Prompt</label>
                            <textarea id="sched-prompt" class="form-control" rows="3"
                                placeholder="Generate a morning briefing on the latest tech news..."></textarea>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                            <div>
                                <label>Schedule Type</label>
                                <select id="sched-type" class="form-control">
                                    <option value="interval">Every X Minutes</option>
                                    <option value="cron">Cron Expression</option>
                                </select>
                            </div>
                            <div>
                                <label>Value</label>
                                <input type="text" id="sched-value" class="form-control" placeholder="60">
                            </div>
                        </div>
                        <button class="btn btn-primary" style="margin-top:12px;" onclick="createScheduledTask()"><i
                                class="fa-solid fa-plus"></i> Create Task</button>
                    </div>

                    <div class="card" style="margin-top:15px;">
                        <h3><i class="fa-solid fa-list"></i> Scheduled Tasks</h3>
                        <div id="sched-task-list" style="margin-top:10px;">
                            <p style="color:var(--text-muted);">No tasks yet.</p>
                        </div>
                    </div>
                </div>

                <!-- Flows View (Phase 27) -->
                <div id="view-flows" class="view-panel hidden">
                    <div class="flows-header">
                        <div>
                            <h1><i class="fa-solid fa-diagram-project"></i> Flows</h1>
                            <p>Build visual automations by connecting blocks. No code required.</p>
                        </div>
                        <div class="flows-header-actions">
                            <button class="btn btn-primary" onclick="createNewFlow()">
                                <i class="fa-solid fa-plus"></i> New Flow
                            </button>
                        </div>
                    </div>

                    <!-- Flow List -->
                    <div id="flows-list-container" class="card" style="margin-top:15px;">
                        <h3><i class="fa-solid fa-folder-open"></i> My Flows</h3>
                        <div id="flows-list" style="margin-top:10px;">
                            <p style="color:var(--text-muted);">No flows yet. Click "New Flow" to get started.</p>
                        </div>
                    </div>

                    <!-- Flow Editor (hidden until a flow is selected) -->
                    <div id="flow-editor-container" class="hidden" style="margin-top:15px;">
                        <div class="card flow-editor-header">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <button class="btn btn-sm" onclick="closeFlowEditor()">
                                    <i class="fa-solid fa-arrow-left"></i> Back
                                </button>
                                <input type="text" id="flow-name-input" class="form-control" placeholder="Flow name"
                                    style="max-width:300px; font-weight:600;">
                                <input type="text" id="flow-desc-input" class="form-control" placeholder="Description"
                                    style="max-width:400px;">
                            </div>
                            <div style="display:flex; gap:8px; margin-top:10px;">
                                <button class="btn btn-success" onclick="saveCurrentFlow()">
                                    <i class="fa-solid fa-save"></i> Save
                                </button>
                                <button class="btn btn-warning" onclick="runCurrentFlow()">
                                    <i class="fa-solid fa-play"></i> Run Flow
                                </button>
                            </div>
                        </div>

                        <!-- Block Palette -->
                        <div class="card flow-block-palette" style="margin-top:10px;">
                            <h4 style="margin-bottom:8px;">Drag blocks onto the canvas:</h4>
                            <div id="flow-palette" class="flow-palette-grid"></div>
                        </div>

                        <!-- Canvas -->
                        <div class="card flow-canvas-wrap" style="margin-top:10px; padding:0; overflow:hidden;">
                            <div id="drawflow-canvas" style="width:100%; height:500px;"></div>
                        </div>

                        <!-- Execution Results -->
                        <div id="flow-results-container" class="card hidden" style="margin-top:10px;">
                            <h3><i class="fa-solid fa-clipboard-list"></i> Execution Results</h3>
                            <pre id="flow-results-output"
                                style="max-height:300px; overflow:auto; background:var(--bg-primary); padding:12px; border-radius:8px; font-size:0.85em;"></pre>
                        </div>
                    </div>
                </div>

                <!-- Analytics View -->
                <div id="view-analytics" class="view-panel hidden">
                    <h1><i class="fa-solid fa-chart-line"></i> Usage Analytics</h1>
                    <p>Track your AI usage ‚Äî tokens consumed, estimated costs, and performance metrics.</p>

                    <div class="card-grid" style="margin-top:15px;">
                        <div class="card">
                            <h3><i class="fa-solid fa-coins"></i> Total Tokens</h3>
                            <div class="metric-value" id="analytics-total-tokens">0</div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-solid fa-dollar-sign"></i> Est. Cost</h3>
                            <div class="metric-value" id="analytics-total-cost">$0.00</div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-solid fa-message"></i> API Calls</h3>
                            <div class="metric-value" id="analytics-total-calls">0</div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-solid fa-bolt"></i> Avg Response</h3>
                            <div class="metric-value" id="analytics-avg-response">0ms</div>
                        </div>
                    </div>

                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:15px;">
                        <div class="card">
                            <h3><i class="fa-solid fa-microchip"></i> Usage by Model</h3>
                            <div id="analytics-by-model" style="margin-top:10px;">
                                <p style="color:var(--text-muted);">No data yet.</p>
                            </div>
                        </div>
                        <div class="card">
                            <h3><i class="fa-solid fa-robot"></i> Usage by Bot</h3>
                            <div id="analytics-by-bot" style="margin-top:10px;">
                                <p style="color:var(--text-muted);">No data yet.</p>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="margin-top:15px;">
                        <h3><i class="fa-solid fa-chart-bar"></i> Daily Usage (Last 30 Days)</h3>
                        <div id="analytics-daily-chart" style="margin-top:10px; height:200px; position:relative;">
                            <canvas id="daily-usage-canvas" style="width:100%; height:200px;"></canvas>
                        </div>
                    </div>
                </div>


                <!-- Activity Log View (NEW) -->
                <div id="view-activity-log" class="view-panel hidden">
                    <h1><i class="fa-solid fa-list-check"></i> Activity Log</h1>
                    <p>Live feed of all tool executions and system events.</p>
                    <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
                        <button class="btn btn-sm btn-secondary" onclick="filterActivity('all')"
                            style="font-size:0.8rem;">All</button>
                        <button class="btn btn-sm btn-secondary" onclick="filterActivity('success')"
                            style="font-size:0.8rem;">‚úÖ Success</button>
                        <button class="btn btn-sm btn-secondary" onclick="filterActivity('error')"
                            style="font-size:0.8rem;">‚ùå Errors</button>
                        <button class="btn btn-sm btn-secondary" onclick="clearActivityLog()"
                            style="font-size:0.8rem; margin-left:auto;">üóëÔ∏è Clear</button>
                    </div>
                    <div class="activity-list" id="activity-log-list">
                        <div class="activity-entry info">
                            <span class="activity-icon"><i class="fa-solid fa-circle-info"></i></span>
                            <span style="flex:1;">Wolfclaw Command Center started. Activity will appear here.</span>
                            <span class="activity-time">just now</span>
                        </div>
                    </div>
                </div>

                <!-- AI Roles / Template Gallery View -->
                <div id="view-ai-roles" class="view-panel hidden">
                    <h1><i class="fa-solid fa-wand-magic-sparkles"></i> AI Roles</h1>
                    <p>Pick a role and your bot is instantly created ‚Äî zero configuration needed.</p>

                    <div id="template-category-filters" style="display:flex; flex-wrap:wrap; gap:8px; margin:15px 0;">
                        <button class="btn btn-sm btn-primary template-filter active" onclick="filterTemplates('all')"
                            data-cat="all">üåü All</button>
                        <!-- Category buttons populated by JS -->
                    </div>

                    <div id="template-gallery"
                        style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:15px; margin-top:10px;">
                        <!-- Template cards populated by JS -->
                    </div>
                </div>

                <!-- Saved Responses (Favorites) View -->
                <div id="view-saved" class="view-panel hidden">
                    <h1><i class="fa-solid fa-star"></i> Saved Responses</h1>
                    <p>Your favorite AI outputs, saved for quick reference.</p>

                    <div id="saved-responses-gallery"
                        style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:15px; margin-top:20px;">
                        <!-- Saved cards populated by JS -->
                    </div>
                </div>

                <!-- Manage Bots View -->
                <div id="view-manage-bots" class="view-panel hidden">
                    <h1>Manage Bots</h1>
                    <p>Create and configure your AI assistants.</p>

                    <button class="btn btn-primary" onclick="toggleNewBotForm()">
                        <i class="fa-solid fa-plus"></i> Create New Bot
                    </button>

                    <div id="new-bot-form-container" class="card hidden" style="margin-top: 20px;">
                        <h3>Create a new Bot Profile</h3>
                        <form id="new-bot-form">
                            <div class="form-group">
                                <label>Bot Name</label>
                                <input type="text" id="new-bot-name" placeholder="e.g. Server Admin Bot" required>
                            </div>
                            <div class="form-group">
                                <label>Model Selection</label>
                                <select id="new-bot-model">
                                    <option value="nvidia/llama-3.1-70b-instruct">Nvidia: Llama 3.1 70B (Free!)</option>
                                    <option value="ollama/llama3">Ollama: Llama 3 (Local)</option>
                                    <option value="gpt-4o">OpenAI: GPT-4o</option>
                                    <option value="claude-3-5-sonnet-20240620">Anthropic: Claude 3.5 Sonnet</option>
                                    <option value="deepseek/deepseek-chat">DeepSeek: Chat</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>System Prompt (SOUL.md)</label>
                                <textarea id="new-bot-prompt" rows="6"
                                    placeholder="You are an expert server administrator..."></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Save Bot</button>
                                <button type="button" class="btn btn-secondary"
                                    onclick="toggleNewBotForm()">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3>Your Bots</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Model</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bot-table-body">
                                <!-- Populated via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Bot Profiles Editor View -->
                <div id="view-bot-profiles" class="view-panel hidden">
                    <h1><i class="fa-solid fa-id-card"></i> Bot Profiles</h1>
                    <p>Edit your bot's personality, your profile, and view its long-term memory.</p>

                    <div class="form-group">
                        <label>Select Bot</label>
                        <div style="display:flex; gap:10px;">
                            <select id="profile-bot-select" onchange="loadBotProfile()" style="flex:1;">
                                <option value="">-- Select a Bot --</option>
                            </select>
                            <button class="btn btn-danger" id="btn-delete-bot" onclick="deleteBotProfile()"
                                style="display:none;" title="Permanently delete this bot">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div id="profile-editor-area" class="hidden">
                        <div class="card" style="margin-top:15px;">
                            <h3>üß† Personality (SOUL.md)</h3>
                            <p style="font-size:0.85em; color: var(--text-muted);">Defines the bot's unique personality
                                and instructions.</p>
                            <textarea id="profile-soul" rows="8" style="width:100%;"></textarea>
                            <button class="btn btn-primary btn-sm" onclick="saveBotProfile('SOUL.md')"
                                style="margin-top:8px;">üíæ Save Personality</button>
                        </div>

                        <div class="card" style="margin-top:15px;">
                            <h3>üë§ Your Profile (USER.md)</h3>
                            <p style="font-size:0.85em; color: var(--text-muted);">Tell the bot about yourself ‚Äî your
                                name, skills, job targets.</p>
                            <textarea id="profile-user" rows="8" style="width:100%;"></textarea>
                            <button class="btn btn-primary btn-sm" onclick="saveBotProfile('USER.md')"
                                style="margin-top:8px;">üíæ Save Profile</button>
                        </div>

                        <div class="card" style="margin-top:15px;">
                            <h3>üß© Long-Term Memory (MEMORY.md)</h3>
                            <p style="font-size:0.85em; color: var(--text-muted);">Auto-updated by the AI after
                                conversations.</p>
                            <textarea id="profile-memory" rows="6" style="width:100%;" disabled></textarea>
                            <button class="btn btn-danger btn-sm" onclick="clearBotMemory()" style="margin-top:8px;">üóëÔ∏è
                                Clear Memory</button>
                        </div>
                    </div>
                </div>

                <!-- Chat View -->
                <div id="view-chat" class="view-panel hidden">
                    <h1><i class="fa-solid fa-comments"></i> Chat</h1>

                    <div id="chat-no-bot" style="text-align:center; padding-top:100px; color:var(--text-color);">
                        <i class="fa-solid fa-robot"
                            style="font-size:3em; margin-bottom:20px; color:var(--primary-color);"></i>
                        <h2>Select an AI Bot</h2>
                        <p>Choose a bot from the dropdown below to start chatting.</p>
                        <select id="chat-bot-select" class="form-select"
                            style="width:300px; margin:20px auto; display:block; padding:10px; font-size:1.1rem; border-radius:8px;">
                            <option value="">-- Select a Bot --</option>
                        </select>
                        <button class="btn btn-primary" onclick="startNewChat()">
                            <i class="fa-solid fa-play"></i> Start New Chat
                        </button>
                    </div>

                    <div id="chat-active" class="hidden" style="display:flex; height:500px; gap:20px;">

                        <!-- History Sidebar -->
                        <div id="chat-history-sidebar"
                            style="width:250px; border-right:1px solid var(--border-color); padding-right:10px; display:flex; flex-direction:column;">
                            <button class="btn btn-primary w-100" style="margin-bottom:15px;" onclick="startNewChat()">
                                <i class="fa-solid fa-plus"></i> New Chat
                            </button>
                            <div
                                style="font-size:0.85em; font-weight:bold; color:var(--text-color); margin-bottom:10px; opacity:0.7;">
                                Recent Chats</div>
                            <div id="chat-history-list"
                                style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:8px;">
                                <!-- History items populated here -->
                            </div>
                        </div>

                        <!-- Main Chat Area -->
                        <div style="flex:1; display:flex; flex-direction:column;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                                <h3 id="chat-bot-name">Bot Name</h3>
                                <div style="display:flex; gap:8px;">
                                    <button class="btn btn-secondary btn-sm" onclick="exportChatToPDFServer()"
                                        title="Export chat as PDF">
                                        <i class="fa-solid fa-file-pdf"></i> PDF
                                    </button>
                                    <button class="btn btn-secondary btn-sm" onclick="exportChatToDOCX()"
                                        title="Export chat as DOCX">
                                        <i class="fa-solid fa-file-word"></i> DOCX
                                    </button>
                                    <button class="btn btn-secondary btn-sm" onclick="endChat()">
                                        <i class="fa-solid fa-stop"></i> End Chat
                                    </button>
                                </div>
                            </div>
                            <div id="chat-messages"
                                style="height:400px; overflow-y:auto; border:1px solid var(--border-color); border-radius:8px; padding:15px; margin-bottom:10px; background: var(--card-bg);">
                                <!-- Messages rendered here -->
                            </div>
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                                <div style="display:flex; gap:10px; align-items:center;">
                                    <select id="chat-document-context" class="form-control"
                                        style="width:200px; padding:6px; font-size:0.9em;">
                                        <option value="">No Context (Standard Chat)</option>
                                        <!-- Populated with uploaded documents -->
                                    </select>
                                    <button class="btn btn-secondary btn-sm"
                                        onclick="document.getElementById('doc-upload-input').click()"
                                        title="Upload a document for context">
                                        <i class="fa-solid fa-file-arrow-up"></i> Upload Doc
                                    </button>
                                    <input type="file" id="doc-upload-input" style="display:none;"
                                        accept=".pdf,.docx,.txt,.csv,.md" onchange="uploadDocument(this)">
                                </div>

                                <div style="display:flex; gap:10px; flex:1; margin-left: 15px;">
                                    <input type="text" id="chat-input" placeholder="Type your message..."
                                        style="flex:1;" onkeypress="if(event.key==='Enter')sendMessage()">
                                    <button class="btn btn-primary" onclick="sendMessage()">
                                        <i class="fa-solid fa-paper-plane"></i> Send
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Remote Servers (SSH) View -->
                <div id="view-remote-servers" class="view-panel hidden">
                    <h1><i class="fa-solid fa-server"></i> Remote Servers (SSH)</h1>
                    <p>Connect Wolfclaw to a remote Linux server so your AI can run commands on it.</p>

                    <div style="display: flex; gap: 20px; margin-top: 15px; height: calc(100vh - 180px);">
                        <!-- Master List: Servers -->
                        <div
                            style="flex: 1; max-width: 280px; display: flex; flex-direction: column; overflow-y: auto; padding-right: 10px;">
                            <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;"
                                onclick="createNewSSHServer()">
                                <i class="fa-solid fa-plus"></i> Add Server
                            </button>
                            <div id="ssh-server-list" style="display: flex; flex-direction: column; gap: 8px;">
                                <!-- Javascript renders items here -->
                            </div>
                        </div>

                        <!-- Detail View: Configuration & Chat -->
                        <div id="ssh-server-details-panel"
                            style="flex: 3; padding-left: 20px; border-left: 1px solid var(--border-color); overflow-y: auto; padding-bottom: 40px;"
                            class="hidden">
                            <div
                                style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div style="flex:1;">
                                    <input type="text" id="ssh-name" placeholder="Server Name (e.g. Production Web)"
                                        style="font-size: 1.5rem; font-weight: 700; color: var(--text-color); background: transparent; border: none; outline: none; width: 100%; margin-bottom: 5px;">
                                    <input type="hidden" id="ssh-id">
                                </div>
                                <button class="btn btn-danger btn-sm" id="ssh-delete-btn" onclick="deleteSSHServer()">
                                    <i class="fa-solid fa-trash"></i> Delete Server
                                </button>
                            </div>

                            <div class="card">
                                <h3>‚öôÔ∏è Connection Settings</h3>
                                <div style="display:flex; gap:10px; margin-top:10px;">
                                    <div class="form-group" style="flex:3;">
                                        <label>IP / Hostname</label>
                                        <input type="text" id="ssh-host" placeholder="e.g. 54.123.45.67">
                                    </div>
                                    <div class="form-group" style="flex:1;">
                                        <label>Port</label>
                                        <input type="text" id="ssh-port" value="22">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>SSH Username</label>
                                    <input type="text" id="ssh-user" value="ubuntu" placeholder="e.g. ubuntu, root">
                                </div>

                                <div style="display:flex; gap:20px; margin-top:15px;">
                                    <div style="flex:1;">
                                        <p style="font-weight:600; font-size:0.9em; margin-bottom:5px;">Password Auth
                                        </p>
                                        <div class="form-group">
                                            <input type="password" id="ssh-password" placeholder="SSH password">
                                        </div>
                                    </div>
                                    <div style="flex:1;">
                                        <p style="font-weight:600; font-size:0.9em; margin-bottom:5px;">PEM Key Auth</p>
                                        <div class="form-group">
                                            <input type="file" id="ssh-pem-file" accept=".pem">
                                            <span id="ssh-pem-status" style="font-size:0.85em;"></span>
                                        </div>
                                    </div>
                                </div>

                                <div style="margin-top:15px; display:flex; gap:10px;">
                                    <button class="btn btn-primary" onclick="saveSSHConfig()">
                                        <i class="fa-solid fa-floppy-disk"></i> Save config
                                    </button>
                                    <button class="btn btn-success" onclick="testSSHConnection()">
                                        <i class="fa-solid fa-plug"></i> Test Connection
                                    </button>
                                </div>
                                <div id="ssh-test-result" style="margin-top:15px;"></div>
                            </div>

                            <div class="card" style="margin-top:20px; border-left: 4px solid var(--accent-color);">
                                <h3><i class="fa-solid fa-robot"></i> Embedded Server Chat</h3>
                                <p style="font-size:0.85em; color:var(--text-muted);">Chat with the AI to manage this
                                    server. It will automatically use the `run_remote_ssh_command` tool.</p>
                                <div id="ssh-chat-messages"
                                    style="height:250px; overflow-y:auto; border:1px solid var(--border-color); border-radius:8px; padding:10px; margin-bottom:10px; background: var(--body-bg); font-family: 'Inter', sans-serif;">
                                </div>
                                <div style="display:flex; gap:10px;">
                                    <input type="text" id="ssh-chat-input"
                                        placeholder="e.g. How much disk space is left?..." style="flex:1;"
                                        onkeypress="if(event.key==='Enter')sendSSHChatMessage()">
                                    <button class="btn btn-primary" onclick="sendSSHChatMessage()"><i
                                            class="fa-solid fa-paper-plane"></i></button>
                                </div>
                            </div>

                            <div class="card" style="margin-top:20px; border-left: 4px solid #0088cc;">
                                <h3><i class="fa-brands fa-telegram"></i> Dedicated Telegram Bot</h3>
                                <p style="font-size:0.85em; color:var(--text-muted);">Deploy an isolated Telegram bot
                                    bound ONLY to this server.</p>
                                <div style="display:flex; gap:10px; margin-top:10px;">
                                    <input type="password" id="dedicated-ssh-token"
                                        placeholder="Telegram Token (123456:ABC...)" style="flex:1;">
                                    <button class="btn btn-primary" onclick="spawnDedicatedSshBot()">Deploy Bot</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Telegram Channels View ‚Äî Bot Army Dashboard -->
                <div id="view-channels" class="view-panel hidden">
                    <h1><i class="fa-brands fa-telegram"></i> Deploy to Telegram</h1>
                    <p>Connect your bots to Telegram for mobile access. Manage your entire bot army from here.</p>

                    <div class="card" style="margin-top:15px;">
                        <h3>Configure Telegram Token</h3>
                        <ol style="font-size:0.9em; color:var(--text-muted); padding-left:20px;">
                            <li>Get a token from <a href="https://t.me/botfather" target="_blank">@BotFather</a>
                            </li>
                            <li>Select your Wolfclaw bot below</li>
                            <li>Paste the token and save</li>
                        </ol>

                        <div class="form-group" style="margin-top:15px;">
                            <label>Select Bot</label>
                            <select id="tg-bot-select" onchange="checkTelegramTokenStatus()">
                                <option value="">-- Select a Bot --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Telegram Bot Token</label>
                            <div style="display:flex; gap:10px;">
                                <input type="password" id="tg-token" placeholder="123456:ABC-DEF..." style="flex:1;">
                                <button class="btn btn-warning" id="btn-unlink-tg" onclick="unlinkTelegramToken()"
                                    style="display:none;" title="Unlink Telegram Token from this Bot">
                                    <i class="fa-solid fa-link-slash"></i>
                                </button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveTelegramToken()" style="margin-top:10px;">
                            <i class="fa-solid fa-floppy-disk"></i> Save Token
                        </button>
                    </div>

                    <div class="card" style="margin-top:15px;">
                        <h3>ü™ñ Bot Army ‚Äî Active Workers</h3>
                        <p style="font-size:0.9em; color:var(--text-muted);">Start and stop Telegram workers for
                            each
                            bot. Only one worker per Telegram token can run at a time.</p>
                        <table class="data-table" style="margin-top:10px;">
                            <thead>
                                <tr>
                                    <th>Bot Name</th>
                                    <th>Model</th>
                                    <th>Token</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="army-table-body">
                                <!-- Populated via JS -->
                            </tbody>
                        </table>
                        <div id="tg-worker-status" style="margin-top:10px;"></div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="view-settings" class="view-panel hidden">
                    <h1>Settings & API Keys</h1>
                    <p>Your keys are saved only on your local computer.</p>

                    <div class="api-key-grid">
                        <!-- Nvidia -->
                        <div class="card">
                            <h3>Nvidia NIM Key <span style="font-size:0.7em; color:var(--success-color);">(Free!)</span>
                            </h3>
                            <form class="api-key-form" data-provider="nvidia">
                                <input type="password" name="key" placeholder="nvapi-...">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                                <button type="button" class="btn btn-danger btn-sm"
                                    onclick="clearApiKey('nvidia')">Clear</button>
                                <span class="status-indicator" id="status-nvidia"></span>
                            </form>
                        </div>

                        <!-- OpenAI -->
                        <div class="card">
                            <h3>OpenAI API Key</h3>
                            <form class="api-key-form" data-provider="openai">
                                <input type="password" name="key" placeholder="sk-...">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                                <button type="button" class="btn btn-danger btn-sm"
                                    onclick="clearApiKey('openai')">Clear</button>
                                <span class="status-indicator" id="status-openai"></span>
                            </form>
                        </div>

                        <!-- Anthropic -->
                        <div class="card">
                            <h3>Anthropic API Key</h3>
                            <form class="api-key-form" data-provider="anthropic">
                                <input type="password" name="key" placeholder="sk-ant-...">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                                <button type="button" class="btn btn-danger btn-sm"
                                    onclick="clearApiKey('anthropic')">Clear</button>
                                <span class="status-indicator" id="status-anthropic"></span>
                            </form>
                        </div>

                        <!-- DeepSeek -->
                        <div class="card">
                            <h3>DeepSeek API Key</h3>
                            <form class="api-key-form" data-provider="deepseek">
                                <input type="password" name="key" placeholder="sk-...">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                                <button type="button" class="btn btn-danger btn-sm"
                                    onclick="clearApiKey('deepseek')">Clear</button>
                                <span class="status-indicator" id="status-deepseek"></span>
                            </form>
                        </div>
                    </div>

                    <!-- Change Password -->
                    <div class="card" style="margin-top: 30px;">
                        <h3>üîí Change Password</h3>
                        <p style="font-size: 0.9em; color: var(--text-muted); margin-bottom: 15px;">
                            Update your local account password.
                        </p>
                        <form id="change-password-form" class="api-key-form" onsubmit="changePassword(event)">
                            <input type="password" id="cp-current" placeholder="Current Password" required
                                style="max-width:200px;">
                            <input type="password" id="cp-new" placeholder="New Password" required
                                style="max-width:200px;">
                            <button type="submit" class="btn btn-warning btn-sm">Update Password</button>
                            <span class="status-indicator" id="status-change-password"></span>
                        </form>
                    </div>

                    <div class="card" style="margin-top: 30px; border-left: 4px solid var(--danger-color);">
                        <h3 style="color: var(--danger-color);"><i class="fa-solid fa-triangle-exclamation"></i>
                            Danger
                            Zone</h3>
                        <p style="font-size: 0.9em; color: var(--text-muted); margin-bottom: 15px;">
                            Permanently delete your local Wolfclaw account, all your bots, and API keys. This cannot
                            be
                            undone.
                        </p>
                        <button class="btn btn-danger" onclick="deleteLocalAccount()">
                            <i class="fa-solid fa-trash"></i> Delete Account
                        </button>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Application Logic -->
    <script src="/static/js/app.js"></script>
</body>

</html>